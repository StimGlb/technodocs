<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Devoir sur la conception, la mod√©lisation et l'impression 3D - TechnoDocs">
    <title>Conception & Impression 3D | TechnoDocs</title>

    <!-- CSS du projet -->
    <link rel="stylesheet" href="/src/css/style.css">
    <link rel="stylesheet" href="/src/css/wizard.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header dynamique -->
    <div id="header-placeholder"></div>

    <main class="wizard">

        <!-- ========== BANNI√àRE TITRE ========== -->
        <div class="wizard__banner">
            <div class="wizard__banner-icon">üñ®Ô∏è</div>
            <div class="wizard__banner-content">
                <h1 class="wizard__banner-title">Mod√©lisation et Impression 3D de votre Objet Technique </h1> Cahier des charges pour fabrication</h1>
            </div>
        </div>
        <!-- ========== INFO √âL√àVE ========== -->
        <div class="wizard__student-info">
            <div class="wizard__student-row">
                <div class="wizard__student-field wizard__student-field--name">
                    <label for="studentName">Pr√©nom et Nom</label>
                    <input type="text" id="studentName" data-field="studentName" placeholder="">
                </div>
                <div class="wizard__student-field wizard__student-field--class">
                    <label for="studentClass">Classe</label>
                    <select id="studentClass" data-field="studentClass">
                        <option value="">‚Äî S√©lectionner ‚Äî</option>
                        <optgroup label="5√®me">
                            <option value="505">5√®me5</option>
                            <option value="506">5√®me6</option>
                            <option value="507">5√®me7</option>
                        </optgroup>
                        <optgroup label="4√®me">
                            <option value="401">4√®me1</option>
                            <option value="402">4√®me2</option>
                            <option value="403">4√®me3</option>
                            <option value="404">4√®me4</option>
                            <option value="405">4√®me5</option>
                            <option value="406">4√®me6</option>
                        </optgroup>
                        <optgroup label="3√®me">
                            <option value="302">3√®me2</option>
                            <option value="303">3√®me3</option>
                            <option value="304">3√®me4</option>
                            <option value="305">3√®me5</option>
                            <option value="306">3√®me6</option>
                            <option value="305">3√®me7</option>
                            <option value="306">3√®me8</option>
                        </optgroup>
                    </select>
                </div>
                <div class="wizard__student-field wizard__student-field--date">
                    <label>Date</label>
                    <span class="wizard__date-display" id="projectDate" data-field="projectDate"></span>
                </div>
            </div>
        </div>

        <!-- ========== PROGRESSION ========== -->
        <section class="wizard__progress">
            <div class="wizard__progress-header">
                <h2 class="wizard__progress-title">Progression</h2>
                <div class="wizard__save-indicator" id="saveIndicator">
                    <span class="wizard__save-dot"></span>
                    <span class="wizard__save-text">Auto-save</span>
                </div>
                <span class="wizard__progress-percentage" id="progressPercentage">0%</span>
            </div>
            <div class="wizard__progress-bar">
                <div class="wizard__progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <!-- Navigation par phases -->
            <nav class="wizard__nav" id="phaseNav">
                <button class="wizard__nav-btn active" data-phase="1">
                    <span class="wizard__nav-number">1</span>
                    <span>Conception</span>
                </button>
                <button class="wizard__nav-btn" data-phase="2">
                    <span class="wizard__nav-number">2</span>
                    <span>Pr√©paration</span>
                </button>
                <button class="wizard__nav-btn" data-phase="3">
                    <span class="wizard__nav-number">3</span>
                    <span>Impression</span>
                </button>
            </nav>
        </section>

        <!-- ========== CONTENEUR FORMULAIRE ========== -->
        <div class="wizard__container">

            <!-- ========== PHASE 1 : Conception et Mod√©lisation ========== -->
            <section class="wizard__phase active" data-phase="1">
                <div class="wizard__phase-header">
                    <div class="wizard__phase-icon">üìê</div>
                    <h2 class="wizard__phase-title">Phase 1 : Conception et Mod√©lisation</h2>
                    <p class="wizard__phase-subtitle">Comprendre les bases de la cr√©ation num√©rique pour l'impression 3D.</p>
                </div>

                <!-- Champ logiciel de mod√©lisation -->
                <div class="wizard__group">
                    <label class="wizard__label required">Quel logiciel de mod√©lisation 3D as-tu d√©j√† utilis√© ou connais-tu ?</label>
                    <p class="wizard__hint">Ex: Tinkercad, SketchUp, Fusion 360, Blender...</p>
                    <input type="text" class="wizard__input" data-field="logicielModelisation" placeholder="Nom du logiciel">
                </div>

                <!-- Zone de texte √©tapes de conception -->
                <div class="wizard__group">
                    <label class="wizard__label required">D√©cris bri√®vement les √©tapes cl√©s de la conception d'un objet destin√© √† l'impression 3D.</label>
                    <textarea class="wizard__textarea" data-field="etapesConception" placeholder="D√©cris les √©tapes depuis l'id√©e jusqu'au mod√®le 3D final."></textarea>
                </div>

                <!-- Zone de texte importance √©chelle -->
                <div class="wizard__group">
                    <label class="wizard__label">Pourquoi est-il important de v√©rifier l'√©chelle de son mod√®le avant l'impression ?</label>
                    <textarea class="wizard__textarea" data-field="importanceEchelle" placeholder="Explique les cons√©quences d'une mauvaise √©chelle."></textarea>
                </div>

                <!-- Navigation -->
                <div class="wizard__phase-nav">
                    <div></div>
                    <button class="btn btn--primary" onclick="wizardGoToPhase(2)">Suivant ‚Üí</button>
                </div>
            </section>

            <!-- ========== PHASE 2 : Pr√©paration √† l'Impression 3D ========== -->
            <section class="wizard__phase" data-phase="2">
                <div class="wizard__phase-header">
                    <div class="wizard__phase-icon">‚öôÔ∏è</div>
                    <h2 class="wizard__phase-title">Phase 2 : Pr√©paration √† l'Impression 3D</h2>
                    <p class="wizard__phase-subtitle">Param√©trer et optimiser ton mod√®le pour l'imprimante.</p>
                </div>

                <!-- S√©lection type de filament -->
                <div class="wizard__group">
                    <label class="wizard__label required">Quel type de filament est le plus courant pour d√©buter en impression 3D ?</label>
                    <select class="wizard__input" data-field="typeFilament">
                        <option value="">‚Äî S√©lectionner ‚Äî</option>
                        <option value="PLA">PLA (Acide Polylactique)</option>
                        <option value="ABS">ABS (Acrylonitrile Butadi√®ne Styr√®ne)</option>
                        <option value="PETG">PETG (Poly√©thyl√®ne T√©r√©phtalate Glycolis√©)</option>
                        <option value="Nylon">Nylon</option>
                    </select>
                </div>

                <!-- Zone de texte r√¥le slicer -->
                <div class="wizard__group">
                    <label class="wizard__label required">Qu'est-ce qu'un "slicer" (logiciel de tranchage) et quel est son r√¥le ?</label>
                    <p class="wizard__hint">Explique son fonctionnement et son utilit√©.</p>
                    <textarea class="wizard__textarea" data-field="roleSlicer" placeholder="Un slicer est un logiciel qui..."></textarea>
                </div>

                <!-- Checkboxes param√®tres slicer -->
                <div class="wizard__group">
                    <label class="wizard__label required">Indique trois param√®tres importants √† r√©gler dans un slicer.</label>
                    <div class="wizard__checkbox-group">
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="parametreSlicer_hauteurCouche">
                            <span class="wizard__checkbox-label">üìè <strong>Hauteur de couche</strong> (r√©solution)</span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="parametreSlicer_remplissage">
                            <span class="wizard__checkbox-label">üì¶ <strong>Taux de remplissage</strong> (solidit√©)</span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="parametreSlicer_supports">
                            <span class="wizard__checkbox-label">üèóÔ∏è <strong>G√©n√©ration de supports</strong> (pour les porte-√†-faux)</span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="parametreSlicer_vitesse">
                            <span class="wizard__checkbox-label">‚ö° <strong>Vitesse d'impression</strong></span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="parametreSlicer_temperature">
                            <span class="wizard__checkbox-label">üå°Ô∏è <strong>Temp√©rature d'extrusion/plateau</strong></span>
                        </label>
                    </div>
                </div>

                <!-- Radio buttons option porte-√†-faux -->
                <div class="wizard__group">
                    <label class="wizard__label required">Si tu devais imprimer une pi√®ce avec des porte-√†-faux importants, quelle option activerais-tu dans le slicer ?</label>
                    <div class="wizard__checkbox-group">
                        <label class="wizard__checkbox-item">
                            <input type="radio" name="optionPorteAFaux" data-field="optionPorteAFaux" value="Supports">
                            <span class="wizard__checkbox-label">üèóÔ∏è <strong>Supports</strong></span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="radio" name="optionPorteAFaux" data-field="optionPorteAFaux" value="Raft">
                            <span class="wizard__checkbox-label">‚öì <strong>Raft</strong></span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="radio" name="optionPorteAFaux" data-field="optionPorteAFaux" value="Brim">
                            <span class="wizard__checkbox-label">üé© <strong>Brim</strong></span>
                        </label>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="wizard__phase-nav">
                    <button class="btn btn--secondary" onclick="wizardGoToPhase(1)">‚Üê Pr√©c√©dent</button>
                    <button class="btn btn--primary" onclick="wizardGoToPhase(3)">Suivant ‚Üí</button>
                </div>
            </section>

            <!-- ========== PHASE 3 : L'Impression et le Post-Traitement ========== -->
            <section class="wizard__phase" data-phase="3">
                <div class="wizard__phase-header">
                    <div class="wizard__phase-icon">‚úÖ</div>
                    <h2 class="wizard__phase-title">Phase 3 : L'Impression et le Post-Traitement</h2>
                    <p class="wizard__phase-subtitle">De l'impression √† la finition de ton objet.</p>
                </div>

                <!-- Zone de texte probl√®me et solution -->
                <div class="wizard__group">
                    <label class="wizard__label required">D√©cris un probl√®me courant rencontr√© lors de l'impression 3D et propose une solution.</label>
                    <p class="wizard__hint">Ex: d√©collement du plateau, bouchage de buse, spaghetti...</p>
                    <textarea class="wizard__textarea" data-field="problemeImpression" placeholder="Probl√®me: ... Solution: ..."></textarea>
                </div>

                <!-- Checkboxes post-traitement -->
                <div class="wizard__group">
                    <label class="wizard__label">Quelles sont les √©tapes de post-traitement que tu pourrais appliquer √† un objet imprim√© en 3D ? (plusieurs r√©ponses possibles)</label>
                    <div class="wizard__checkbox-group">
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="postTraitement_poncage">
                            <span class="wizard__checkbox-label"> sandpaper <strong>Pon√ßage</strong></span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="postTraitement_peinture">
                            <span class="wizard__checkbox-label">üé® <strong>Peinture</strong></span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="postTraitement_assemblage">
                            <span class="wizard__checkbox-label">üîó <strong>Assemblage</strong> de plusieurs pi√®ces</span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="postTraitement_nettoyage">
                            <span class="wizard__checkbox-label">üßº <strong>Nettoyage</strong> (retrait des supports, bavures)</span>
                        </label>
                    </div>
                </div>

                <!-- Zone de texte avantage impression 3D -->
                <div class="wizard__group">
                    <label class="wizard__label required">Selon toi, quel est l'avantage principal de l'impression 3D ?</label>
                    <textarea class="wizard__textarea" data-field="avantageImpression" placeholder="L'impression 3D permet de..."></textarea>
                </div>

                <!-- Zone de texte exp√©rience personnelle -->
                <div class="wizard__group">
                    <label class="wizard__label">As-tu d√©j√† imprim√© un objet en 3D ? Si oui, d√©cris-le.</label>
                    <textarea class="wizard__textarea" data-field="experienceImpression" placeholder="Oui, j'ai imprim√©... / Non, pas encore."></textarea>
                </div>

                <!-- Bo√Æte IA (optionnel) -->
                <div class="wizard__ai-box">
                    <p class="wizard__ai-title">ü§ñ Utilisation de l'IA (optionnel)</p>
                    <p>Si tu as utilis√© une IA pour t'aider (ex: pour des d√©finitions, des id√©es), note ton prompt :</p>
                    <textarea data-field="aiPrompt" placeholder="Ex: J'ai demand√© √† ChatGPT de me lister les √©tapes de la mod√©lisation 3D."></textarea>
                </div>

                <!-- Navigation finale -->
                <div class="wizard__phase-nav">
                    <button class="btn btn--secondary" onclick="wizardGoToPhase(2)">‚Üê Pr√©c√©dent</button>
                    <button class="btn btn--success" onclick="wizardComplete()">‚úÖ Terminer</button>
                </div>
            </section>

        </div>

        <!-- ========== BARRE D'ACTIONS ========== -->
        <div class="wizard__actions">
            <button class="btn btn--secondary btn--small" onclick="wizardExportJSON()">üì§ Exporter</button>
            <button class="btn btn--secondary btn--small" onclick="document.getElementById('importInput').click()">üì• Importer</button>
            <input type="file" id="importInput" accept=".json" style="display:none" onchange="wizardImportJSON(event)">
            <button class="btn btn--secondary btn--small" onclick="handleSafeReset()">üóëÔ∏è R√©initialiser</button>
        </div>
    </main>

    <!-- Footer dynamique -->
    <div id="footer-placeholder"></div>

    <!-- ========== MODALES ========== -->

    <!-- Modal Compl√©tion -->
    <div class="wizard__modal-overlay" id="completionModal">
        <div class="wizard__modal">
            <h3 class="wizard__modal-title">üéâ F√©licitations !</h3>
            <div class="wizard__modal-content">
                <p>Tu as termin√© ton travail !</p>
                <p style="margin-top:1rem">Tes r√©ponses ont √©t√© <strong>sauvegard√©es automatiquement</strong> dans la base de donn√©es.</p>
                <p style="margin-top:0.75rem;font-size:0.875rem;color:var(--color-gray-500)">
                    Tu peux aussi exporter une copie locale.
                </p>
            </div>
            <div class="wizard__modal-actions">
                <button class="btn btn--secondary" onclick="wizardCloseModal('completionModal')">Fermer</button>
                <button class="btn btn--primary" onclick="wizardExportJSON();wizardCloseModal('completionModal')">üì§ Exporter</button>
            </div>
        </div>
    </div>

    <!-- Modal Reset -->
    <div class="wizard__modal-overlay" id="resetModal">
        <div class="wizard__modal">
            <h3 class="wizard__modal-title">‚ö†Ô∏è R√©initialiser ?</h3>
            <div class="wizard__modal-content">
                <p>Une <strong>sauvegarde</strong> a √©t√© t√©l√©charg√©e automatiquement.</p>
                <p>Voulez-vous vraiment <strong>supprimer d√©finitivement</strong> vos r√©ponses de la base de donn√©es ?</p>
            </div>
            <div class="wizard__modal-actions">
                <button class="btn btn--secondary" onclick="wizardCloseModal('resetModal')">Annuler</button>
                <button class="btn btn--primary" style="background:var(--color-error)" onclick="wizardReset()">üóëÔ∏è R√©initialiser</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="wizard__toast" id="wizardToast">
        <span class="wizard__toast-icon"></span>
        <span class="wizard__toast-message"></span>
    </div>

    <!-- ========== SCRIPTS ========== -->
    <script type="module" src="/src/js/components.js"></script>
    <script type="module">
        // ============================================
        // CONFIGURATION FIREBASE - √Ä ADAPTER
        // ============================================
        import { WizardFirebase } from '/src/js/wizard-firebase.js';

        // Cr√©er l'instance du wizard avec Firestore
        window.wizardInstance = new WizardFirebase({
            // Nom de la collection Firestore (unique par formulaire)
            collectionName: 'devoir_conception_impression_3d',
            
            // Intervalle d'autosave (en ms)
            autosaveInterval: 60000,
            
            // Champs obligatoires par phase pour marquer "completed"
            requiredFields: {
                1: ['studentName', 'logicielModelisation', 'etapesConception', 'formatFichier'],
                2: ['typeFilament', 'roleSlicer', 'optionPorteAFaux'],
                3: ['problemeImpression', 'avantageImpression']
            },
            
            // Callback √† la compl√©tion
            onComplete: (data) => {
                console.log('üéâ Formulaire compl√©t√©:', data);
            },
            
            // Callback sauvegarde r√©ussie
            onSaveSuccess: (data) => {
                console.log('‚úÖ Sauvegarde Firestore OK');
            },
            
            // Callback erreur de sauvegarde
            onSaveError: (error) => {
                console.error('‚ùå Erreur Firestore:', error);
            }
        });

        /**
        * S√©curise la r√©initialisation en for√ßant un export JSON 
        * avant de demander la confirmation de suppression.
        */
        window.handleSafeReset = function() {
            console.log("Pr√©paration de la r√©initialisation : Export de secours...");
            
            // 1. On d√©clenche l'export JSON existant
            // Note : wizardExportJSON est suppos√© √™tre accessible globalement
            if (typeof wizardExportJSON === "function") {
                wizardExportJSON();
            } else if (window.wizardInstance) {
                // Si la fonction n'est pas globale, on peut essayer via l'instance
                window.wizardInstance.exportToJSON(); 
            }

            // 2. On affiche un petit message dans le toast pour informer l'√©l√®ve
            if (window.wizardInstance && window.wizardInstance.showToast) {
                window.wizardInstance.showToast("Sauvegarde de secours t√©l√©charg√©e !", "success");
            }

            // 3. On ouvre enfin la modale de confirmation
            wizardShowModal('resetModal');
        };
    </script>
</body>
</html>