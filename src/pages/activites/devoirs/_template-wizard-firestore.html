<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="[DESCRIPTION] - TechnoDocs">
    <title>[TITRE] | TechnoDocs</title>

    <!-- CSS du projet -->
    <link rel="stylesheet" href="/src/css/style.css">
    <link rel="stylesheet" href="/src/css/wizard.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header dynamique -->
    <div id="header-placeholder"></div>

    <main class="wizard">

        <!-- ========== BANNI√àRE TITRE ========== -->
        <div class="wizard__banner">
            <div class="wizard__banner-icon">üéØ</div>
            <div class="wizard__banner-content">
                <h1 class="wizard__banner-title">Titre du devoir</h1>
                <div class="wizard__banner-skills">
                    <span class="wizard__skill">CT 2.1</span>
                    <span class="wizard__skill">CT 4.2</span>
                    <span class="wizard__skill">CS 5.6</span>
                </div>
            </div>
        </div>
        <!-- ========== INFO √âL√àVE ========== -->
        <div class="wizard__student-info">
            <div class="wizard__student-row">
                <div class="wizard__student-field wizard__student-field--name">
                    <label for="studentName">Pr√©nom et Nom</label>
                    <input type="text" id="studentName" data-field="studentName" placeholder="Ton nom complet">
                </div>
                <div class="wizard__student-field wizard__student-field--class">
                    <label for="studentClass">Classe</label>
                    <select id="studentClass" data-field="studentClass">
                        <option value="">‚Äî S√©lectionner ‚Äî</option>
                        <optgroup label="5√®me">
                            <option value="505">5√®me5</option>
                            <option value="506">5√®me6</option>
                            <option value="507">5√®me7</option>
                        </optgroup>
                        <optgroup label="4√®me">
                            <option value="401">4√®me1</option>
                            <option value="402">4√®me2</option>
                            <option value="403">4√®me3</option>
                            <option value="404">4√®me4</option>
                            <option value="405">4√®me5</option>
                            <option value="406">4√®me6</option>
                        </optgroup>
                        <optgroup label="3√®me">
                            <option value="302">3√®me2</option>
                            <option value="303">3√®me3</option>
                            <option value="304">3√®me4</option>
                            <option value="305">3√®me5</option>
                            <option value="306">3√®me6</option>
                            <option value="305">3√®me7</option>
                            <option value="306">3√®me8</option>
                        </optgroup>
                    </select>
                </div>
                <div class="wizard__student-field wizard__student-field--date">
                    <label>Date</label>
                    <span class="wizard__date-display" id="projectDate" data-field="projectDate"></span>
                </div>
            </div>
        </div>

        <!-- ========== PROGRESSION ========== -->
        <section class="wizard__progress">
            <div class="wizard__progress-header">
                <h2 class="wizard__progress-title">Progression</h2>
                <div class="wizard__save-indicator" id="saveIndicator">
                    <span class="wizard__save-dot"></span>
                    <span class="wizard__save-text">Auto-save</span>
                </div>
                <span class="wizard__progress-percentage" id="progressPercentage">0%</span>
            </div>
            <div class="wizard__progress-bar">
                <div class="wizard__progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <!-- Navigation par phases -->
            <nav class="wizard__nav" id="phaseNav">
                <button class="wizard__nav-btn active" data-phase="1">
                    <span class="wizard__nav-number">1</span>
                    <span>Phase 1</span>
                </button>
                <button class="wizard__nav-btn" data-phase="2">
                    <span class="wizard__nav-number">2</span>
                    <span>Phase 2</span>
                </button>
                <button class="wizard__nav-btn" data-phase="3">
                    <span class="wizard__nav-number">3</span>
                    <span>Phase 3</span>
                </button>
            </nav>
        </section>

        <!-- ========== CONTENEUR FORMULAIRE ========== -->
        <div class="wizard__container">

            <!-- ========== PHASE 1 ========== -->
            <section class="wizard__phase active" data-phase="1">
                <div class="wizard__phase-header">
                    <div class="wizard__phase-icon">üì¶</div>
                    <h2 class="wizard__phase-title">Phase 1 : Titre de la phase</h2>
                    <p class="wizard__phase-subtitle">Description de cette √©tape</p>
                </div>

                <!-- Champ texte simple -->
                <div class="wizard__group">
                    <label class="wizard__label required">Label du champ</label>
                    <p class="wizard__hint">Indication pour aider l'√©l√®ve</p>
                    <input type="text" class="wizard__input" data-field="champTexte" placeholder="Placeholder...">
                </div>

                <!-- Zone de texte -->
                <div class="wizard__group">
                    <label class="wizard__label">Description</label>
                    <textarea class="wizard__textarea" data-field="description" placeholder="D√©cris..."></textarea>
                </div>

                <!-- Bo√Æte conseil -->
                <div class="wizard__tips">
                    <p class="wizard__tips-title">üí° Conseil</p>
                    <p class="wizard__tips-content">Un conseil utile pour cette phase.</p>
                </div>

                <!-- Navigation -->
                <div class="wizard__phase-nav">
                    <div></div>
                    <button class="btn btn--primary" onclick="wizardGoToPhase(2)">Suivant ‚Üí</button>
                </div>
            </section>

            <!-- ========== PHASE 2 ========== -->
            <section class="wizard__phase" data-phase="2">
                <div class="wizard__phase-header">
                    <div class="wizard__phase-icon">üîç</div>
                    <h2 class="wizard__phase-title">Phase 2 : Titre</h2>
                    <p class="wizard__phase-subtitle">Description</p>
                </div>

                <!-- Checkboxes multiples -->
                <div class="wizard__group">
                    <label class="wizard__label required">S√©lectionne une ou plusieurs options</label>
                    <div class="wizard__checkbox-group">
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="option_a">
                            <span class="wizard__checkbox-label">üîß <strong>Option A</strong> ‚Äî Description</span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="option_b">
                            <span class="wizard__checkbox-label">üì¶ <strong>Option B</strong> ‚Äî Description</span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="checkbox" data-field="option_c">
                            <span class="wizard__checkbox-label">üéØ <strong>Option C</strong> ‚Äî Description</span>
                        </label>
                    </div>
                </div>

                <!-- Radio buttons (choix unique) -->
                <div class="wizard__group">
                    <label class="wizard__label required">Choisis une seule option</label>
                    <div class="wizard__checkbox-group">
                        <label class="wizard__checkbox-item">
                            <input type="radio" name="choixUnique" data-field="choixUnique" value="valeur1">
                            <span class="wizard__checkbox-label">üå± <strong>Choix 1</strong></span>
                        </label>
                        <label class="wizard__checkbox-item">
                            <input type="radio" name="choixUnique" data-field="choixUnique" value="valeur2">
                            <span class="wizard__checkbox-label">üí™ <strong>Choix 2</strong></span>
                        </label>
                    </div>
                </div>

                <!-- Champs en ligne -->
                <div class="wizard__group">
                    <label class="wizard__label">Dimensions (mm)</label>
                    <div class="wizard__dimensions">
                        <input type="number" class="wizard__input" data-field="dimL" placeholder="L" style="width:80px">
                        <span>√ó</span>
                        <input type="number" class="wizard__input" data-field="dimW" placeholder="l" style="width:80px">
                        <span>√ó</span>
                        <input type="number" class="wizard__input" data-field="dimH" placeholder="h" style="width:80px">
                        <span>mm</span>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="wizard__phase-nav">
                    <button class="btn btn--secondary" onclick="wizardGoToPhase(1)">‚Üê Pr√©c√©dent</button>
                    <button class="btn btn--primary" onclick="wizardGoToPhase(3)">Suivant ‚Üí</button>
                </div>
            </section>

            <!-- ========== PHASE 3 ========== -->
            <section class="wizard__phase" data-phase="3">
                <div class="wizard__phase-header">
                    <div class="wizard__phase-icon">‚úÖ</div>
                    <h2 class="wizard__phase-title">Phase 3 : Validation</h2>
                    <p class="wizard__phase-subtitle">Derni√®re √©tape</p>
                </div>

                <!-- Tableau de saisie -->
                <div class="wizard__group">
                    <label class="wizard__label">Tableau exemple</label>
                    <table class="wizard__table">
                        <thead>
                            <tr>
                                <th>Colonne 1</th>
                                <th>Colonne 2</th>
                                <th>Colonne 3</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" data-field="row1_col1"></td>
                                <td><input type="text" data-field="row1_col2"></td>
                                <td>
                                    <select data-field="row1_col3">
                                        <option value="">‚Äî</option>
                                        <option value="oui">‚úÖ Oui</option>
                                        <option value="non">‚ùå Non</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td><input type="text" data-field="row2_col1"></td>
                                <td><input type="text" data-field="row2_col2"></td>
                                <td>
                                    <select data-field="row2_col3">
                                        <option value="">‚Äî</option>
                                        <option value="oui">‚úÖ Oui</option>
                                        <option value="non">‚ùå Non</option>
                                    </select>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Bo√Æte IA (optionnel) -->
                <div class="wizard__ai-box">
                    <p class="wizard__ai-title">ü§ñ Utilisation de l'IA (optionnel)</p>
                    <p>Si tu as utilis√© une IA, note ton prompt :</p>
                    <textarea data-field="aiPrompt" placeholder="Ex: J'ai demand√© √†..."></textarea>
                </div>

                <!-- Navigation finale -->
                <div class="wizard__phase-nav">
                    <button class="btn btn--secondary" onclick="wizardGoToPhase(2)">‚Üê Pr√©c√©dent</button>
                    <button class="btn btn--success" onclick="wizardComplete()">‚úÖ Terminer</button>
                </div>
            </section>

        </div>

        <!-- ========== BARRE D'ACTIONS ========== -->
        <div class="wizard__actions">
            <button class="btn btn--secondary btn--small" onclick="wizardExportJSON()">üì§ Exporter</button>
            <button class="btn btn--secondary btn--small" onclick="document.getElementById('importInput').click()">üì• Importer</button>
            <input type="file" id="importInput" accept=".json" style="display:none" onchange="wizardImportJSON(event)">
            <button class="btn btn--secondary btn--small" onclick="wizardShowModal('resetModal')">üóëÔ∏è R√©initialiser</button>
        </div>
    </main>

    <!-- Footer dynamique -->
    <div id="footer-placeholder"></div>

    <!-- ========== MODALES ========== -->

    <!-- Modal Compl√©tion -->
    <div class="wizard__modal-overlay" id="completionModal">
        <div class="wizard__modal">
            <h3 class="wizard__modal-title">üéâ F√©licitations !</h3>
            <div class="wizard__modal-content">
                <p>Tu as termin√© ton travail !</p>
                <p style="margin-top:1rem">Tes r√©ponses ont √©t√© <strong>sauvegard√©es automatiquement</strong> dans la base de donn√©es.</p>
                <p style="margin-top:0.75rem;font-size:0.875rem;color:var(--color-gray-500)">
                    Tu peux aussi exporter une copie locale.
                </p>
            </div>
            <div class="wizard__modal-actions">
                <button class="btn btn--secondary" onclick="wizardCloseModal('completionModal')">Fermer</button>
                <button class="btn btn--primary" onclick="wizardExportJSON();wizardCloseModal('completionModal')">üì§ Exporter</button>
            </div>
        </div>
    </div>

    <!-- Modal Reset -->
    <div class="wizard__modal-overlay" id="resetModal">
        <div class="wizard__modal">
            <h3 class="wizard__modal-title">‚ö†Ô∏è R√©initialiser ?</h3>
            <div class="wizard__modal-content">
                <p>Cette action va <strong>supprimer toutes tes r√©ponses</strong> de la base de donn√©es. Irr√©versible !</p>
            </div>
            <div class="wizard__modal-actions">
                <button class="btn btn--secondary" onclick="wizardCloseModal('resetModal')">Annuler</button>
                <button class="btn btn--primary" style="background:var(--color-error)" onclick="wizardReset()">üóëÔ∏è R√©initialiser</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="wizard__toast" id="wizardToast">
        <span class="wizard__toast-icon"></span>
        <span class="wizard__toast-message"></span>
    </div>

    <!-- ========== SCRIPTS ========== -->
    <script type="module" src="/src/js/components.js"></script>
    <script type="module">
        // ============================================
        // CONFIGURATION FIREBASE - √Ä ADAPTER
        // ============================================
        import { WizardFirebase } from '/src/js/wizard-firebase.js';

        // Cr√©er l'instance du wizard avec Firestore
        window.wizardInstance = new WizardFirebase({
            // Nom de la collection Firestore (unique par formulaire)
            collectionName: 'wizard_template',
            
            // Intervalle d'autosave (en ms)
            autosaveInterval: 15000,
            
            // Champs obligatoires par phase pour marquer "completed"
            requiredFields: {
                1: ['champTexte'],
                2: ['choixUnique'],
                3: []
            },
            
            // Callback √† la compl√©tion
            onComplete: (data) => {
                console.log('üéâ Formulaire compl√©t√©:', data);
            },
            
            // Callback sauvegarde r√©ussie
            onSaveSuccess: (data) => {
                console.log('‚úÖ Sauvegarde Firestore OK');
            },
            
            // Callback erreur de sauvegarde
            onSaveError: (error) => {
                console.error('‚ùå Erreur Firestore:', error);
            }
        });
    </script>
</body>
</html>