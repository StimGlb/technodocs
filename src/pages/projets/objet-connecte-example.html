<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Objet Connect√© - Technologie</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Grotesk:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #22d3ee;
        --primary-dark: #0891b2;
        --secondary: #fb7185;
        --success: #10b981;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-700: #374151;
        --white: #ffffff;
      }
      body {
        font-family: "Inter", sans-serif;
        background: #f9fafb;
        color: var(--gray-700);
        line-height: 1.6;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: var(--white);
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid var(--gray-100);
        padding-bottom: 20px;
      }
      h1 {
        font-family: "Space Grotesk", sans-serif;
        color: #111827;
        margin: 0;
      }

      .progress-container {
        margin-bottom: 30px;
      }
      .progress-bar {
        height: 10px;
        background: var(--gray-200);
        border-radius: 5px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        width: 0%;
        transition: width 0.3s;
      }

      .phase {
        display: none;
        animation: fadeIn 0.4s;
      }
      .phase.active {
        display: block;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .field-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 0.95rem;
      }
      input,
      textarea,
      select {
        width: 100%;
        padding: 12px;
        border: 2px solid var(--gray-200);
        border-radius: 8px;
        box-sizing: border-box;
        font-size: 1rem;
      }
      input:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary);
      }

      .nav-btns {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
      }
      .btn {
        padding: 12px 24px;
        border-radius: 8px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: 0.2s;
      }
      .btn-prev {
        background: var(--gray-200);
      }
      .btn-next {
        background: var(--primary);
        color: white;
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .info-box {
        background: #e0f2fe;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid var(--primary);
        margin-bottom: 20px;
        font-size: 0.9rem;
      }
      .prompt-area {
        background: #f3f4f6;
        padding: 15px;
        border-radius: 8px;
        border: 1px dashed var(--primary);
        margin-top: 20px;
      }

      /* Grid layout pour les champs multiples */
      .field-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
      }
      .field-row {
        display: flex;
        gap: 10px;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üì° Cr√©ation d'un Objet Connect√©</h1>
        <p>Concevoir un objet connect√© pour am√©liorer le quotidien</p>
      </header>

      <div class="progress-container">
        <div
          style="
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 5px;
          "
        >
          <span id="step-label">√âtape 1 sur 4</span>
          <span id="progress-percent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
      </div>

      <!-- ====== PHASE 1 ====== -->
      <div class="phase active" id="phase-1">
        <h2>1. D√©finition du besoin</h2>
        <div class="info-box">
          <strong>üí° Conseil :</strong> Un objet connect√© r√©sout un probl√®me
          concret gr√¢ce √† des capteurs et une connexion r√©seau.
        </div>

        <div class="field-group">
          <label>Nom de l'objet connect√© :</label>
          <input
            type="text"
            data-save="objet_nom"
            placeholder="Ex: Station m√©t√©o intelligente, Pot connect√©..."
          />
        </div>

        <div class="field-group">
          <label>Quel probl√®me r√©sout-il ? :</label>
          <textarea
            data-save="probleme"
            rows="3"
            placeholder="Ex: Oublier d'arroser les plantes, ne pas conna√Ætre la qualit√© de l'air..."
          ></textarea>
        </div>

        <div class="field-group">
          <label>Public cible :</label>
          <select data-save="public_cible">
            <option value="">‚Äî S√©lectionner ‚Äî</option>
            <option value="famille">Famille / Domicile</option>
            <option value="collegiens">Coll√©giens</option>
            <option value="seniors">Seniors</option>
            <option value="professionnels">Professionnels</option>
            <option value="ecole">√âcole / Coll√®ge</option>
          </select>
        </div>
      </div>

      <!-- ====== PHASE 2 ====== -->
      <div class="phase" id="phase-2">
        <h2>2. Composants et capteurs</h2>
        <div class="info-box">
          <strong>üîß Rappel :</strong> Un objet connect√© = microcontr√¥leur +
          capteurs + connectivit√© (WiFi/Bluetooth)
        </div>

        <div class="field-group">
          <label>Microcontr√¥leur choisi :</label>
          <select data-save="microcontroleur">
            <option value="">‚Äî S√©lectionner ‚Äî</option>
            <option value="arduino_uno">Arduino Uno</option>
            <option value="esp32">ESP32 (WiFi + Bluetooth)</option>
            <option value="raspberry_pi">Raspberry Pi</option>
            <option value="micro_bit">Micro:bit</option>
            <option value="autre">Autre</option>
          </select>
        </div>

        <div class="field-group">
          <label>Capteurs n√©cessaires :</label>
          <select data-save="capteurs" multiple style="height: 100px">
            <option>Temp√©rature (DHT22)</option>
            <option>Humidit√©</option>
            <option>Luminosit√© (LDR)</option>
            <option>Mouvement (PIR)</option>
            <option>Qualit√© de l'air</option>
            <option>Pression atmosph√©rique</option>
            <option>Distance (ultrason)</option>
            <option>Cam√©ra</option>
            <option>Son / Microphone</option>
          </select>
          <small style="color: #666"
            >Maintenez Ctrl pour s√©lectionner plusieurs options</small
          >
        </div>

        <div class="field-group">
          <label>Type de connectivit√© :</label>
          <select data-save="connectivite">
            <option value="">‚Äî S√©lectionner ‚Äî</option>
            <option value="wifi">WiFi</option>
            <option value="bluetooth">Bluetooth</option>
            <option value="lora">LoRa (longue distance)</option>
            <option value="gsm">GSM (carte SIM)</option>
            <option value="zigbee">ZigBee</option>
          </select>
        </div>
      </div>

      <!-- ====== PHASE 3 ====== -->
      <div class="phase" id="phase-3">
        <h2>3. Programmation et interface</h2>
        <div class="info-box">
          <strong>üíª Important :</strong> D√©finir comment l'utilisateur va
          interagir avec l'objet (app, web, √©cran...)
        </div>

        <div class="field-group">
          <label>Langage de programmation :</label>
          <select data-save="langage_prog">
            <option value="">‚Äî S√©lectionner ‚Äî</option>
            <option value="arduino_c">C/C++ (Arduino IDE)</option>
            <option value="micropython">MicroPython</option>
            <option value="scratch_arduino">Scratch for Arduino</option>
            <option value="python">Python (Raspberry Pi)</option>
            <option value="javascript">JavaScript (Node.js)</option>
          </select>
        </div>

        <div class="field-group">
          <label>Interface utilisateur :</label>
          <select
            data-save="interface_utilisateur"
            multiple
            style="height: 80px"
          >
            <option>Application mobile</option>
            <option>Site web</option>
            <option>√âcran LCD sur l'objet</option>
            <option>LED d'information</option>
            <option>Notifications push</option>
            <option>Vocal (synth√®se vocale)</option>
          </select>
        </div>

        <div class="field-group">
          <label>Donn√©es √† afficher :</label>
          <textarea
            data-save="donnees_affichage"
            rows="3"
            placeholder="Ex: Temp√©rature en temps r√©el, historique graphique, alertes..."
          ></textarea>
        </div>
      </div>

      <!-- ====== PHASE 4 (finale) ====== -->
      <div class="phase" id="phase-4">
        <h2>4. Plan de r√©alisation</h2>
        <p>
          Voici le r√©sum√© de votre projet d'objet connect√©. Vous pouvez
          l'utiliser pour :
        </p>
        <ul>
          <li>Pr√©senter votre projet √† la classe</li>
          <li>Demander conseil pour la r√©alisation</li>
          <li>Commander les composants n√©cessaires</li>
        </ul>

        <div class="prompt-area">
          <textarea
            id="summary-output"
            readonly
            style="
              height: 200px;
              background: transparent;
              border: none;
              resize: none;
            "
            placeholder="Le r√©sum√© de votre projet appara√Ætra ici..."
          ></textarea>
        </div>
        <button
          class="btn btn-next"
          onclick="copySummary()"
          style="margin-top: 10px; width: 100%"
        >
          üìã Copier le r√©sum√© du projet
        </button>

        <div style="margin-top: 20px; text-align: center">
          <button
            class="btn"
            onclick="exportData()"
            style="
              background: var(--secondary);
              color: white;
              margin-right: 10px;
            "
          >
            üíæ Exporter en JSON
          </button>
          <button
            class="btn"
            onclick="window.print()"
            style="background: var(--gray-700); color: white"
          >
            üñ®Ô∏è Imprimer
          </button>
        </div>
      </div>

      <div class="nav-btns">
        <button
          class="btn btn-prev"
          id="btn-prev"
          onclick="changePhase(-1)"
          disabled
        >
          Pr√©c√©dent
        </button>
        <button class="btn btn-next" id="btn-next" onclick="changePhase(1)">
          Suivant
        </button>
      </div>
    </div>

    <script>
      // ============================================
      // CONFIGURATION DU WIZARD
      // ============================================
      const WIZARD_CONFIG = {
        totalPhases: 4,
        storageKey: "objet_connecte_project",
        summaryTemplate: `üîó PROJET OBJET CONNECT√â

üì± Objet : {{objet_nom}}
üéØ Probl√®me r√©solu : {{probleme}}
üë• Public : {{public_cible}}

‚ö° TECHNIQUE
üî¨ Microcontr√¥leur : {{microcontroleur}}
üìä Capteurs : {{capteurs}}
üåê Connectivit√© : {{connectivite}}

üíª PROGRAMMATION  
üîß Langage : {{langage_prog}}
üì± Interface : {{interface_utilisateur}}
üìà Donn√©es : {{donnees_affichage}}

‚úÖ Prochaines √©tapes :
1. Acheter les composants list√©s
2. Apprendre le langage de programmation choisi  
3. Prototyper sur breadboard
4. D√©velopper l'interface utilisateur
5. Tester et optimiser`,
        summaryFields: [
          "objet_nom",
          "probleme",
          "public_cible",
          "microcontroleur",
          "capteurs",
          "connectivite",
          "langage_prog",
          "interface_utilisateur",
          "donnees_affichage",
        ],
        copySuccessMessage:
          "‚úÖ R√©sum√© du projet copi√© ! Vous pouvez le coller dans un document.",
        validationRules: {
          1: ["objet_nom", "probleme"],
          2: ["microcontroleur", "capteurs"],
          3: ["langage_prog", "interface_utilisateur"],
        },
      };

      // ============================================
      // LOGIQUE WIZARD (NE PAS MODIFIER)
      // ============================================
      let currentPhase = 1;

      function updateUI() {
        // Mise √† jour des phases actives
        document.querySelectorAll(".phase").forEach((p, i) => {
          p.classList.toggle("active", i + 1 === currentPhase);
        });

        // Mise √† jour des boutons
        document.getElementById("btn-prev").disabled = currentPhase === 1;
        const nextBtn = document.getElementById("btn-next");
        nextBtn.innerText =
          currentPhase === WIZARD_CONFIG.totalPhases ? "Terminer" : "Suivant";

        // Mise √† jour de la barre de progression
        const percent = Math.round(
          ((currentPhase - 1) / (WIZARD_CONFIG.totalPhases - 1)) * 100,
        );
        document.getElementById("progress-fill").style.width = percent + "%";
        document.getElementById("progress-percent").innerText = percent + "%";
        document.getElementById("step-label").innerText =
          `√âtape ${currentPhase} sur ${WIZARD_CONFIG.totalPhases}`;

        // G√©n√©ration du r√©sum√© en phase finale
        if (currentPhase === WIZARD_CONFIG.totalPhases) {
          generateSummary();
        }
      }

      function changePhase(direction) {
        // Validation avant passage √† la phase suivante
        if (direction > 0 && !validateCurrentPhase()) {
          return; // Bloquer si validation √©choue
        }

        currentPhase = Math.max(
          1,
          Math.min(WIZARD_CONFIG.totalPhases, currentPhase + direction),
        );
        updateUI();
        saveData();
      }

      function validateCurrentPhase() {
        const requiredFields =
          WIZARD_CONFIG.validationRules[currentPhase] || [];
        const missingFields = [];

        requiredFields.forEach((fieldKey) => {
          const element = document.querySelector(`[data-save="${fieldKey}"]`);
          if (!element || !element.value.trim()) {
            const label = element
              ? element
                  .closest(".field-group")
                  .querySelector("label")
                  .textContent.replace(":", "")
              : fieldKey;
            missingFields.push(label);
          }
        });

        if (missingFields.length > 0) {
          alert(
            `‚ö†Ô∏è Veuillez remplir les champs obligatoires :\n\n‚Ä¢ ${missingFields.join("\n‚Ä¢ ")}`,
          );
          return false;
        }
        return true;
      }

      function saveData() {
        const data = {};
        document.querySelectorAll("[data-save]").forEach((el) => {
          if (el.type === "checkbox") {
            data[el.getAttribute("data-save")] = el.checked;
          } else if (el.multiple) {
            const selected = Array.from(el.selectedOptions).map(
              (opt) => opt.value,
            );
            data[el.getAttribute("data-save")] = selected.join(", ");
          } else {
            data[el.getAttribute("data-save")] = el.value;
          }
        });
        localStorage.setItem(WIZARD_CONFIG.storageKey, JSON.stringify(data));
      }

      function loadData() {
        const saved = localStorage.getItem(WIZARD_CONFIG.storageKey);
        if (saved) {
          const data = JSON.parse(saved);
          document.querySelectorAll("[data-save]").forEach((el) => {
            const value = data[el.getAttribute("data-save")];
            if (value !== undefined) {
              if (el.type === "checkbox") {
                el.checked = value;
              } else if (el.multiple) {
                // Pour les select multiple, s√©lectionner les options
                const values = value.split(", ");
                Array.from(el.options).forEach((option) => {
                  option.selected = values.includes(option.value);
                });
              } else {
                el.value = value;
              }
            }
          });
        }
      }

      function generateSummary() {
        const data = JSON.parse(
          localStorage.getItem(WIZARD_CONFIG.storageKey) || "{}",
        );
        let summary = WIZARD_CONFIG.summaryTemplate;

        // Remplacer les placeholders {{field_key}} par les valeurs
        Object.keys(data).forEach((key) => {
          const placeholder = new RegExp(`{{${key}}}`, "g");
          summary = summary.replace(
            placeholder,
            data[key] || "(non renseign√©)",
          );
        });

        // Nettoyer les placeholders non remplac√©s
        summary = summary.replace(/{{[^}]+}}/g, "(non d√©fini)");

        document.getElementById("summary-output").value = summary;
      }

      function copySummary() {
        const summaryText = document.getElementById("summary-output");
        summaryText.select();
        summaryText.setSelectionRange(0, 99999); // Pour mobile

        try {
          document.execCommand("copy");
          alert(WIZARD_CONFIG.copySuccessMessage);
        } catch (err) {
          // Fallback moderne
          navigator.clipboard
            ?.writeText(summaryText.value)
            .then(() => {
              alert(WIZARD_CONFIG.copySuccessMessage);
            })
            .catch(() => {
              alert(
                "‚ùå Erreur lors de la copie. S√©lectionnez le texte manuellement avec Ctrl+A puis Ctrl+C.",
              );
            });
        }
      }

      // Fonction d'export JSON
      function exportData() {
        const data = {
          projectName: "Objet Connect√©",
          projectType: "IoT_Device",
          exportDate: new Date().toISOString(),
          studentInfo: {
            // Ajout automatique des infos √©tudiant si disponibles
            timestamp: new Date().toLocaleString("fr-FR"),
          },
          formData: JSON.parse(
            localStorage.getItem(WIZARD_CONFIG.storageKey) || "{}",
          ),
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `objet_connecte_${data.formData.objet_nom || "projet"}_${new Date().toISOString().split("T")[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);

        alert("üíæ Donn√©es export√©es avec succ√®s !");
      }

      // Sauvegarde automatique √† chaque saisie
      document.addEventListener("input", () => {
        saveData();
        // Feedback visuel l√©ger
        document.title = "üíæ " + document.title.replace("üíæ ", "");
        setTimeout(() => {
          document.title = document.title.replace("üíæ ", "");
        }, 1000);
      });

      // Initialisation au chargement
      window.onload = () => {
        loadData();
        updateUI();
      };

      // Raccourcis clavier
      document.addEventListener("keydown", (e) => {
        if (
          e.ctrlKey &&
          e.key === "ArrowRight" &&
          currentPhase < WIZARD_CONFIG.totalPhases
        ) {
          changePhase(1);
        } else if (e.ctrlKey && e.key === "ArrowLeft" && currentPhase > 1) {
          changePhase(-1);
        } else if (e.ctrlKey && e.key === "s") {
          e.preventDefault();
          saveData();
          alert("üíæ Donn√©es sauvegard√©es manuellement !");
        }
      });
    </script>
  </body>
</html>
